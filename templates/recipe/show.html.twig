{% extends "base.html.twig" %}

{% block title %}{{ recipe.name }}{% endblock %}

{% block body %}

<div class="container mx-auto mt-10 pt-10 pb-10 border-t-2 border-b-2 border-gray-300">

    <div class="flex flex-row justify-evenly h-96">

        <img class="object-cover h-full w-1/2 rounded-lg" src="{{ recipe.background ? asset('upload/recipes/' ~ recipe.background) : asset('assets_img/default_img.jpg') }}" alt="{{ recipe.name }}">

        <div class="h-full w-1/2 flex flex-col p-4 justify-between">

            <div class="w-full h-auto flex flex-col gap-2">
                <div class="uppercase w-full font-semibold tracking-wider text-md">Titre</div>
                <h1 class="text-md">{{ recipe.name }}</h1>
            </div>

            <div class="w-full h-auto flex flex-col gap-2">
                <div class="uppercase w-full font-semibold tracking-wider text-md">Description</div>
                <h1 class="text-md">{{ recipe.description }}</h1>
            </div>

            <div class="w-full h-auto flex flex-col gap-2">
                <div class="uppercase w-full font-semibold tracking-wider text-md">Saison</div>
                <h1 class="text-md">{{ recipe.season }}</h1>
            </div>

            <div class="w-full h-auto flex flex-col gap-2">
                <div class="uppercase w-full font-semibold tracking-wider text-md">Évènement</div>
                <h1 class="text-md">{{ recipe.event }}</h1>
            </div>

        </div>

    </div>
    
    <div class="flex flex-row gap-5 h-16 mt-5">

        <div class="rounded-lg w-1/3 h-full bg-gray-500 pt-4 pb-4 flex flex-row justify-center">
            <div class="flex flex-row gap-2 h-full w-1/2 justify-center items-center">
                <img class="object-cover rounded-full h-full" src="{{ asset('/upload/users/' ~ recipe.createdBy.avatar ) }}" alt="Avatar de {{ recipe.createdBy.pseudo }}">
                <h1 class="text-lg text-white uppercase font-semibold tracking-wider">Publié par {{ recipe.createdBy.pseudo }}</h1>
            </div>
        </div>

        <div class="rounded-lg w-1/3 h-full bg-gray-500 pt-4 pb-4 flex flex-row justify-center">
            <div class="flex flex-row gap-2 h-full w-1/2 justify-center items-center">
                <i class="fas fa-calendar-alt text-white text-lg"></i>
                <h1 class="text-lg text-white uppercase font-semibold tracking-wider">Publié le {{ recipe.createdAt|date('d-m-Y') }}</h1>
            </div>
        </div>

        {% set statusFav = "far" %}
        {% if app.user %}
            {% for favorite in app.user.favorites %}
                {% if recipe.id == favorite.id %}
                    {% set statusFav = "fas" %}
                {% endif %}
            {% endfor %}
        {% endif %}
        <div class="fav rounded-lg w-1/3 h-full bg-gray-500 pt-4 pb-4 flex flex-row gap-2 items-center justify-center text-lg text-white uppercase font-semibold tracking-wider cursor-pointer">
            <i data-recipe="{{ recipe.id }}" class="{{ statusFav }} fa-star text-white"></i>
            Ajouter aux favoris
        </div>

    </div>

    {# Commentaires #}
    <div class="flex flex-col h-auto gap-5 py-4 w-full my-4 border-t-2 border-gray-300">
        {% for message in recipe.messages %}

            <div class="flex flex-row border border-gray-300 shadow-lg px-4 py-2 h-auto">

                    <img class="object-cover rounded-full h-12 self-start" src="{{ asset('/upload/users/' ~ message.author.avatar ) }}" alt="Avatar de {{ message.author.pseudo }}">

                    <div class="w-full flex flex-col flex-wrap overflow-ellipsis overflow-hidden self-center">

                        <h2 class="w-full mx-4 pt-3 text-gray-800 text-md pb-1 border-b border-gray-300">
                            {{ message.author.pseudo }}
                        </h2>

                        <p class="flex flex-wrap px-3 max-w-full h-auto overflow-ellipsis overflow-hidden mb-2 mt-2">
                            {{ message.message }}
                        </p>
                        
                    </div>
            </div>

        {% endfor %}
    </div>

    {# Formulaire envoie de commentaire #}
    {% if app.user %}    
        <div class="flex flex-row h-52 items-center w-full rounded-lg p-4">
            <img class="object-cover rounded-full h-12 self-start" src="{{ asset('/upload/users/' ~ app.user.avatar ) }}" alt="Avatar de {{ app.user.pseudo }}">

            {{ form_start(form, {
                attr: {
                    class: "w-full rounded-lg px-4 pt-5"
                }
            }) }}

            <div class="flex flex-wrap -mx-3 mb-6">

                <h2 class="w-full mx-4 pt-3 text-gray-800 text-lg pb-1 border-b border-gray-300">
                    <i class="fas fa-comments"></i>
                    Ajouter un nouveau commentaire
                </h2>

                <div class="w-full md:w-full px-3 mb-2 mt-2">
                    {{ form_row(form.message) }}
                </div>

                {{ form_widget(form) }}

                <div class="w-full md:w-full flex items-start md:w-full px-3">
                    <button type="submit" class="bg-white w-full text-gray-700 font-medium py-1 px-4 border border-gray-400 rounded-lg tracking-wide mr-1 hover:bg-gray-100" formnovalidate>Publier le commentaire</button>
                </div>
  
            </div>
            {{ form_end(form) }}
        </div>
    {% endif %}

</div>

    <hr>

    {% for message in recipe.messages %}
        <div class="bg-gray-300 text-white">
            <span>{{ message.author.pseudo }}</span>
            <p>{{ message.message }}</p>
        </div> 
    {% endfor %}

    <hr>

    {% if app.user %}    
        {{ form_start(form) }}
            {{ form_widget(form) }}

            <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold rounded focus:outline-none focus:shadow-outline py-3 px-6 w-full" formnovalidate>Envoyer le message</button>
        {{ form_end(form) }}
    {% endif %}

</div>

{% endblock %}


